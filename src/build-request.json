{
  "kind": "build_request",
  "title": "Fix library save failure for songs and covers",
  "projectName": "Voice Cover Studio",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-52",
      "text": "Debug and fix the library save mechanism in App.tsx by examining the handleProcessingComplete and handleGenerationComplete callback functions to identify why songs are not being saved to the backend after cover mode processing completes",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "Identify the exact point of failure in the library save workflow for cover mode",
        "Console logs show the complete execution path from processing completion to backend save call",
        "Any errors or exceptions in the save flow are captured and logged"
      ]
    },
    {
      "id": "REQ-53",
      "text": "Debug and fix the library save mechanism in App.tsx by examining the handleProcessingComplete and handleGenerationComplete callback functions to identify why songs are not being saved to the backend after generation mode processing completes",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "Identify the exact point of failure in the library save workflow for generation mode",
        "Console logs show the complete execution path from lyrics submission to backend save call",
        "Any errors or exceptions in the save flow are captured and logged"
      ]
    },
    {
      "id": "REQ-54",
      "text": "Verify that the backend actor's createCover function is being called with complete and correct parameters (songId, voiceSampleId, audio blob) from the useProcessingStatus hook's final step",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "Backend createCover function receives all required parameters",
        "Function returns a valid cover ID upon successful creation",
        "Any backend errors are properly propagated to the frontend"
      ]
    },
    {
      "id": "REQ-55",
      "text": "Verify that the backend actor's submitLyricsRequest function is correctly storing lyrics-based song generation requests and that the generated songs are being persisted to the library storage",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "Backend submitLyricsRequest function successfully stores the request",
        "Generated songs from lyrics requests are persisted to library storage",
        "Library query functions return all saved songs including those from lyrics generation"
      ]
    },
    {
      "id": "REQ-56",
      "text": "Add comprehensive console logging throughout App.tsx to track the complete library save workflow including: when processing completes, what data is passed to save functions, backend actor call results, and navigation to library view",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "Console logs show exact state at processing completion",
        "Console logs show all parameters being passed to backend save functions",
        "Console logs show backend response (success or error)",
        "Console logs show navigation trigger to library view"
      ]
    },
    {
      "id": "REQ-57",
      "text": "Ensure that after both cover mode and generation mode complete, the application automatically navigates to the Library view and the newly created song appears in the library list without requiring page refresh",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "User is automatically navigated to Library view after processing completes",
        "Newly created song appears in the library list immediately",
        "React Query cache is invalidated to refetch library data",
        "No page refresh is required to see the new song"
      ]
    },
    {
      "id": "REQ-58",
      "text": "Add error toast notifications in App.tsx that display user-friendly error messages when songs fail to save to the library, including specific details about what went wrong",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "My songs are still not going to my library fix this"
        ]
      },
      "acceptanceCriteria": [
        "Toast notification appears when library save fails",
        "Error message is user-friendly and actionable",
        "Technical details are logged to console for debugging"
      ]
    }
  ],
  "constraints": [
    "Do not modify the backend single-actor architecture",
    "Do not edit read-only files in frontend/src/hooks/useInternetIdentity.ts or frontend/src/components/ui",
    "Preserve the existing two-mode workflow (cover mode and generation mode)",
    "Maintain compatibility with existing voice persona system"
  ],
  "nonGoals": [
    "Changing the UI/UX of the Library or Personas components",
    "Modifying the audio processing or generation simulation logic",
    "Adding new features beyond fixing the library save issue",
    "Refactoring unrelated code"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}